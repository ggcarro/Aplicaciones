<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min.js"></script>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <title>Teleamigos</title>
</head>
<body>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
        <a class="navbar-brand" href="index.jquery.html">Cliente JavaScript Teleamigos</a>
        <div class="navbar navbar-light" style="background-color: #e3fded;">
            <span class="navbar-text
              text-body">
                Amigos:
            </span>
            <span id="numeroAmigos" class="text-body">
            </span>
        </div>
    </nav>
    <div class="center-block">
        <div class="container">
            <div class="row">
                <h3>Amigos:</h3>
                <div id="amigos" />
                </div>
            </div>
        <div class="row">
            <div class="col-sm-3">
                <h2>Añade un nuevo amigo:</h2>
                <div class="input-group input-group-sm mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-sm">Nombre</span>
                    </div>
                    <input type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm" id="name" />
                </div>
                <div class="input-group input-group-sm mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-sm">Longitud</span>
                    </div>
                    <input type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm" id="longi" />
                </div>
                <div class="input-group input-group-sm mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-sm">Latitud</span>
                    </div>
                    <input type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm" id="lati" />
                </div>
                <button type="submit" class="btn btn-success" id="add" onclick="AddFriend()">Agregar</button>
            </div>
            <div class="col-sm-3">
                <h2>Elimina a un amigo:</h2>
                <div class="input-group input-group-sm mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-sm">ID</span>
                    </div>
                    <input type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm" id="ID" />
                </div>
                <button type="submit" class="btn btn-danger" id="delete" onclick="DeleteFriend()">Eliminar</button>
            </div>
            <div class="col-sm-3">
                <h2>Edita un nuevo amigo:</h2>
                <div class="input-group input-group-sm mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-sm">Id</span>
                    </div>
                    <input type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm" id="IdEd" />
                </div>
                <div class="input-group input-group-sm mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-sm">Nombre</span>
                    </div>
                    <input type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm" id="nameEd" />
                </div>
                <div class="input-group input-group-sm mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-sm">Longitud</span>
                    </div>
                    <input type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm" id="longiEd" />
                </div>
                <div class="input-group input-group-sm mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-sm">Latitud</span>
                    </div>
                    <input type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm" id="latiEd" />
                </div>
                <button type="submit" class="btn btn-success" id="add" onclick="ModifyFriend()">Editar</button>
            </div>
        </div>
        </div>
    </div>

    <script>
        async function Load() {
            var uri = "http://localhost:5000/api/amigo";


            const response = await fetch(uri);
            const listData = await response.json();
            document.getElementById("amigos").innerHTML = "";
            var listContainer = document.getElementById("amigos");
            var listElement = document.createElement('ul');
            listContainer.appendChild(listElement);

            for (let i = 0; i < listData.length; i++) {

                var listItem = document.createElement('li');
                listItem.innerHTML = listData[i].name + ": " + listData[i].id;
                listElement.appendChild(listItem);

                var numeroAmigos = listData.length;

                $("#numeroAmigos").text(numeroAmigos);
            }
        }
        Load();
    function AddFriend() {
        var uri = "http://localhost:5000/api/amigo";
        var _name = document.getElementById("name").value;
        var _longi = document.getElementById("longi").value;
        var _lati = document.getElementById("lati").value;

        var data = {name: _name, longi: _longi, lati: _lati }

        $("#amigos").html("");
        fetch(uri, {
            method: "POST",
            body: JSON.stringify(data),
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(function (response) {Load() })
            .catch(error => console.error('No se pudo añadir el amigo:', error))
            .then(response => console.log('Amigo añadido correctamente:', response));

    }

    function ModifyFriend() {
        var uri = "http://localhost:5000/api/amigo";
        var _id = document.getElementById("IdEd").value;
        var _name = document.getElementById("nameEd").value;
        var _longi = document.getElementById("longiEd").value;
        var _lati = document.getElementById("latiEd").value;

        var data = {ID: _id, name: _name, longi: _longi, lati: _lati }
        var url = uri + "/" + _id;

        fetch(url, {
            method: "PUT",
            body: JSON.stringify(data),
            headers: {
               'Content-Type': 'application/json'
    }
        }).then(function (response) {Load(); })
            .catch(error => console.error('No se pudo modificar el amigo:', error))
            .then(response => console.log('Amigo añadido correctamente:', response));
    }

    function DeleteFriend() {
        var uri = "http://localhost:5000/api/amigo";
        var data = (document.getElementById("ID")).value;
        var url = uri + "/" + data;

        fetch(url, {
            method: "DELETE",
            headers: {
                'Content-Type': 'application/json'
    }
            }).then(function (response) {Load(); })
            .catch(error => console.error('No se puedo eliminar el amigo... los amigos de verdad se quedan:', error))
            .then(response => console.log('Amigo eliminado correctamente... te vas a quedar sin amigos si sigues asi:', response));
    }
</script>
</body>
</html>
