<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script>

        function SetupEditor() {
            var editor = ace.edit("source");
            editor.setTheme("ace/theme/clouds");
            editor.getSession().setMode("ace/mode/lua");

            editor.commands.addCommand({
                name: 'RunProgramCommand',
                bindKey: { win: 'Ctrl-Enter', mac: 'Command-Enter' },
                exec: function (editor) {
                    Run(editor.getSession().getValue());
                }
            });
            editor.focus();
        }

        async function Run(source) {
            var serviceBase = 'http://localhost:5010/api/progeto';

            program = {};
            program.source = source;

            try {
                const response = await fetch(serviceBase, {
                    method: "post",
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(program)
                });

                const data = await response.json();

                $('#result').html(data.result);
                $('#svg').html(data.svg);

            } catch (error) {
                alert(error);
            }
            svgPanZoom('#drawing');
        }
    </script>
    <script src="/ace-builds/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
    <script>
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/javascript");
    </script>

</head>
<style type="text/css">
    .border{border:solid 10px; border-color: black; padding:10px;}
    .c1{min-width: 49%; padding: 50px;}
</style>
<body onload="SetupEditor()">
    <!--Navbar-->
    <nav class="navbar navbar-dark bg-dark">
        <a class="navbar-brand" href="#">Progeto</a>
        <button class="btn btn-outline-info my-2 my-sm-0">Run</button>
    </nav>

    <!--Main Container-->
    <main>
        <div class="row">
            <div class="col-md-1 c1">
                <div class="row border" id="editor"></div>
                <textarea readonly class="row border" id="result"></textarea>
            </div>
            <div class="col-md-1 c1" style="padding:50px">
                <div class="row border" id="svg">
                    <h1>Hola 3</h1>
                </div>
            </div>
        </div>
    </main>
    
</body>

</html>
